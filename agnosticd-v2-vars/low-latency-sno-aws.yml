---
# ===================================================================
# Low-Latency Performance Workshop - Student SNO Deployment
# Hub + Spoke Architecture - Student Cluster
# ===================================================================
# This configuration deploys a Single Node OpenShift (SNO) cluster
# for individual students to perform hands-on performance tuning.
#
# ARCHITECTURE:
#   - This is the "Spoke" in the Hub + Spoke architecture
#   - Workshop documentation (Showroom) is hosted on a separate Hub cluster
#   - This cluster may reboot during Module 4 (Performance Profile)
#   - Students access this cluster via bastion for hands-on work
#
# DEPLOYMENT ORDER:
#   1. Deploy student SNO clusters FIRST (this config)
#   2. Collect bastion credentials from each deployment
#   3. Deploy Hub cluster SECOND with collected credentials
#
# ===================================================================

# ===================================================================
# Mandatory Variables (agnosticd-v2)
# ===================================================================
cloud_provider: aws
cloud_provider_version: main
config: openshift-cluster

# ===================================================================
# Collections (agnosticd-v2 best practice)
# ===================================================================
requirements_content:
  collections:
  - name: https://github.com/agnosticd/core_workloads.git
    type: git
    version: main

# ===================================================================
# AWS Configuration
# ===================================================================
aws_region: us-east-2

cloud_tags:
  - owner: takinosh@redhat.com
  - Purpose: low-latency-workshop
  - config: openshift-cluster
  - guid: "{{ guid }}"

# ===================================================================
# SNO Configuration (1 control plane, 0 workers = SNO)
# ===================================================================
control_plane_instance_count: 1
worker_instance_count: 0

# Instance Type Configuration
# ===================================================================
# DEFAULT: Virtualized instance (workshop-friendly, cost-effective)
# - Supports CPU isolation, HugePages, NUMA tuning (Module 4)
# - RT kernel is disabled by default (works on virtualized instances)
# - Cost: ~$0.77/hour (us-east-2)
control_plane_instance_type: m5.4xlarge

# OPTIONAL: Bare-Metal instance (for Real-Time kernel support)
# ===================================================================
# Uncomment ONE of the options below if you need RT kernel support in Module 4
# RT kernel requires bare-metal instances and is ~5x more expensive
#
# RECOMMENDED: m5zn.metal (best latency, smallest metal instance)
# - 48 vCPUs, 192 GiB RAM
# - Cost: ~$3.96/hour (us-east-2)
# - Best for: Low-latency workloads requiring RT kernel
# control_plane_instance_type: m5zn.metal
#
# ALTERNATIVE: c5.metal (compute-optimized)
# - 96 vCPUs, 192 GiB RAM
# - Cost: ~$4.08/hour (us-east-2)
# - Best for: CPU-intensive workloads
# control_plane_instance_type: c5.metal
#
# ALTERNATIVE: c5n.metal (compute-optimized, enhanced networking)
# - 72 vCPUs, 192 GiB RAM, 100 Gbps network
# - Cost: ~$3.89/hour (us-east-2)
# - Best for: Network-intensive workloads
# control_plane_instance_type: c5n.metal
#
# ALTERNATIVE: m5.metal (general-purpose)
# - 96 vCPUs, 384 GiB RAM
# - Cost: ~$4.61/hour (us-east-2)
# - Best for: Balanced workloads needing more memory
# control_plane_instance_type: m5.metal
#
# ALTERNATIVE: c7i.metal-24xl (latest generation, compute-optimized)
# - 96 vCPUs, 192 GiB RAM
# - Cost: ~$4.28/hour (us-east-2)
# - Best for: Latest generation performance
# control_plane_instance_type: c7i.metal-24xl
#
# NOTE: Pricing is approximate and may vary by region and over time
# Check current pricing at: https://aws.amazon.com/ec2/pricing/on-demand/
# ===================================================================

control_plane_storage_size: 200
control_plane_storage_type: gp3

# Installation method
host_ocp4_deploy_installation_method: openshift_install
host_ocp4_installer_version: "4.20"
host_ocp4_installer_set_user_data_kubeadmin_password: true

# ===================================================================
# Bastion Configuration
# ===================================================================
install_bastion: true
bastion_setup_student_user: true
bastion_student_user_name: lab-user

# SSH Keys
host_ssh_authorized_keys:
  - key: https://github.com/tosin2013.keys

# ===================================================================
# Repository Configuration
# ===================================================================
install_satellite_repositories: false
install_rhn_repositories: true

# Required in secrets.yml:
# host_satellite_repositories_hostname:
# host_satellite_repositories_org:
# host_satellite_repositories_activationkey:

# ===================================================================
# Workloads (all from core_workloads collection)
# ===================================================================
workloads:
  # Core operators for workshop
  - agnosticd.core_workloads.ocp4_workload_cert_manager
  - agnosticd.core_workloads.ocp4_workload_openshift_virtualization
  # NOTE: SR-IOV operator workload does not exist in core_workloads collection
  # - agnosticd.core_workloads.ocp4_workload_sriov_network_operator
  # NOTE: Showroom is NOT deployed here - it's hosted on the Hub cluster
  # This ensures workshop docs remain available during Module 4 reboots

# ===================================================================
# Cert Manager Workload Configuration
# ===================================================================
ocp4_workload_cert_manager_channel: stable-v1
ocp4_workload_cert_manager_provider: letsencrypt
# Let's Encrypt email (required for account registration and notifications)
# Set this in secrets file or pass as extra var: -e "ocp4_workload_cert_manager_email=your-email@example.com"
ocp4_workload_cert_manager_email: "{{ ocp4_workload_cert_manager_email | default('admin@example.com') }}"
ocp4_workload_cert_manager_aws_region: "{{ aws_region }}"
ocp4_workload_cert_manager_aws_access_key_id: "{{ aws_access_key_id }}"
ocp4_workload_cert_manager_aws_secret_access_key: "{{ aws_secret_access_key }}"
# Enable SSL certificates for secure HTTPS access
# Requires AWS credentials with Route53 permissions for DNS-01 challenge
ocp4_workload_cert_manager_install_ingress_certificates: true
# NOTE: API certificates disabled during initial deployment to avoid SSL verification
# errors when AgnosticD connects before Let's Encrypt certificates are ready.
# API will use default self-signed certificate (still secure, just not Let's Encrypt).
# Ingress certificates are installed and will be available for console/apps access.
ocp4_workload_cert_manager_install_api_certificates: false

# ===================================================================
# OpenShift Virtualization Workload Configuration
# ===================================================================
ocp4_workload_openshift_virtualization_channel: stable
ocp4_workload_openshift_virtualization_wait_for_deploy: true

# ===================================================================
# SR-IOV Network Operator Workload Configuration
# ===================================================================
ocp4_workload_sriov_network_operator_channel: stable

